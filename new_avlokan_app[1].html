<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>अवलोकन • Avlokan – Bilingual Mental Health Chatbot</title>
  <style>
    :root {
      --bg-light: #eaf6ff;
      --card-light: #ffffff;
      --ink-light: #0b2239;
      --muted-light: #3a5169;
      --brand-light: #2563eb;
      --brand-2-light: #22c55e;
      --danger-light: #b91c1c;
      --ok-light: #15803d;
      --chip-light: #0ea5e9;

      --bg-dark: #121b2a;
      --card-dark: #1e293b;
      --ink-dark: #cbd5e1;
      --muted-dark: #94a3b8;
      --brand-dark: #3b82f6;
      --brand-2-dark: #22c55e;
      --danger-dark: #ef4444;
      --ok-dark: #22c55e;
      --chip-dark: #22d3ee;
    }
    [data-theme="light"] {
      --bg: var(--bg-light);
      --card: var(--card-light);
      --ink: var(--ink-light);
      --muted: var(--muted-light);
      --brand: var(--brand-light);
      --brand-2: var(--brand-2-light);
      --danger: var(--danger-light);
      --ok: var(--ok-light);
      --chip: var(--chip-light);
    }
    [data-theme="dark"] {
      --bg: var(--bg-dark);
      --card: var(--card-dark);
      --ink: var(--ink-dark);
      --muted: var(--muted-dark);
      --brand: var(--brand-dark);
      --brand-2: var(--brand-2-dark);
      --danger: var(--danger-dark);
      --ok: var(--ok-dark);
      --chip: var(--chip-dark);
    }
    * {
      box-sizing: border-box;
    }
    html,
    body {
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--ink);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      transition: background-color 0.3s, color 0.3s;
    }
    #app {
      width: min(920px, 100%);
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
      height: 90vh;
      max-height: 900px;
    }
    .panel {
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      border: 1px solid #e6eef6;
      display: flex;
      flex-direction: column;
    }
    /* LEFT: sidebar */
    #sidebar {
      padding: 14px;
      display: flex;
      flex-direction: column;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 4px 8px 12px 8px;
    }
    .logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      display: grid;
      place-items: center;
      color: white;
      font-weight: 800;
    }
    h1 {
      font-size: 18px;
      margin: 0;
    }
    .sub {
      font-size: 12px;
      color: var(--muted);
    }
    .section {
      margin-top: 14px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }
    .section h3 {
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      margin: 12px 6px;
      flex-shrink: 0;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #f2f7ff;
      border: 1px solid #e6eef6;
      color: var(--ink);
      padding: 6px 10px;
      border-radius: 999px;
      margin: 6px 6px 0 0;
      cursor: pointer;
      font-size: 12px;
      user-select: none;
      transition: background-color 0.3s, color 0.3s;
    }
    .pill:hover {
      background: #eef4ff;
    }
    .danger {
      background: #fff2f2;
      border-color: #ffdede;
      color: var(--danger);
    }
    .ok {
      background: #f1fff6;
      border-color: #dff7e9;
      color: var(--ok);
    }
    .note {
      font-size: 12px;
      color: var(--muted);
      padding: 8px 8px 0 8px;
      flex-shrink: 0;
    }

    /* RIGHT: chat */
    #chatbox {
      display: flex;
      flex-direction: column;
      height: 100%;
      min-height: 560px;
    }
    #topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      border-bottom: 1px solid var(--muted);
      flex-shrink: 0;
    }
    #status {
      font-weight: 600;
    }
    #langWrap {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .langBtn {
      background: var(--ink);
      color: var(--card);
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    .langBtn[aria-pressed="true"] {
      background: var(--brand);
      color: white;
    }
    #themeToggle {
      margin-left: 12px;
      font-size: 12px;
      cursor: pointer;
      border: none;
      padding: 6px 12px;
      border-radius: 10px;
      background: var(--brand-2);
      color: white;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    #themeToggle:hover {
      background: #16a34a;
    }
    #chatlogs {
      flex: 1;
      overflow-y: auto;
      padding: 14px;
      background: linear-gradient(180deg, var(--card) 0%, #fbfdff 100%);
      border-radius: 0 0 16px 16px;
      scrollbar-width: thin;
      scrollbar-color: var(--brand) transparent;
    }
    #chatlogs::-webkit-scrollbar {
      width: 8px;
    }
    #chatlogs::-webkit-scrollbar-thumb {
      background-color: var(--brand);
      border-radius: 10px;
    }
    .msg {
      max-width: 80%;
      padding: 10px 14px;
      margin: 8px 0;
      border-radius: 16px;
      line-height: 1.4;
      word-wrap: break-word;
      transition: background-color 0.3s, color 0.3s;
    }
    .bot {
      background: var(--brand);
      color: white;
      align-self: flex-start;
      border-top-left-radius: 4px;
    }
    .user {
      background: var(--ink);
      color: white;
      align-self: flex-end;
      border-top-right-radius: 4px;
    }
    .time {
      display: block;
      font-size: 10px;
      opacity: 0.7;
      margin-top: 6px;
      user-select: none;
    }
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px 12px;
      border-top: 1px solid var(--muted);
      background: var(--card);
      border-radius: 0 0 16px 16px;
      flex-shrink: 0;
    }
    .chip {
      background: var(--ink);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 12px;
      user-select: none;
      transition: background-color 0.3s;
    }
    .chip:hover {
      background: var(--brand);
    }
    .chip.alt {
      background: var(--brand);
    }
    #inputArea {
      display: flex;
      gap: 8px;
      padding: 12px;
      border-top: 1px solid var(--muted);
      background: var(--card);
      border-radius: 0 0 16px 16px;
      flex-shrink: 0;
    }
    #inputBox {
      flex: 1;
      border-radius: 14px;
      border: 1px solid #d9e6f2;
      padding: 12px 14px;
      font-size: 15px;
      outline: none;
      transition: border-color 0.3s;
    }
    #inputBox:focus {
      border-color: var(--brand);
    }
    #sendBtn {
      background: var(--ink);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: filter 0.3s;
    }
    #sendBtn:hover {
      filter: brightness(1.05);
    }
    .typing {
      opacity: 0.6;
      font-style: italic;
    }
    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      background: #020202;
      padding: 2px 6px;
      border-radius: 6px;
      font-size: 12px;
      user-select: none;
    }

    @media (max-width: 820px) {
      #app {
        grid-template-columns: 1fr;
        height: 100vh;
      }
      #chatbox {
        height: 80vh;
      }
      #sidebar {
        height: unset;
        padding-bottom: 10px;
      }
    }
  </style>
</head>
<body data-theme="light">
  <div id="app">
    <!-- Sidebar -->
    <aside id="sidebar" class="panel">
      <div class="brand">
        <div class="logo">A</div>
        <div>
          <h1>अवलोकन • Avlokan</h1>
          <div class="sub">Bilingual mental-wellness companion</div>
        </div>
      </div>

      <div class="section">
        <h3>Quick Tools</h3>
        <div class="pill ok" data-tool="/ground">5-4-3-2-1 Grounding</div>
        <div class="pill ok" data-tool="/boxbreathe">Box Breathing</div>
        <div class="pill ok" data-tool="/478">4-7-8 Breathing</div>
        <div class="pill ok" data-tool="/reframe">CBT Thought Reframe</div>
        <div class="pill ok" data-tool="/journal">Journaling Prompt</div>
        <div class="pill ok" data-tool="/sleep">Sleep Hygiene Tips</div>
        <div class="pill ok" data-tool="/study">Study Focus (Pomodoro)</div>
      </div>

      <div class="section">
        <h3>Safety</h3>
        <div class="pill danger" data-tool="/helpnow">I need urgent help</div>
        <div class="note">If you or someone else is in immediate danger, contact your local emergency number (e.g., <b>112</b>) or go to the nearest hospital. Avlokan is supportive guidance, not a substitute for professional care.</div>
      </div>

      <div class="section" style="flex-direction: row; align-items: center; justify-content: space-between; margin-top: 18px;">
        <h3 style="margin: 0;">Tips</h3>
        <button id="themeToggle" title="Toggle Light/Dark Mode">Dark Mode</button>
      </div>
      <div class="section" style="margin-top: 6px;">
        <div class="note">Type <span class="kbd">/help</span> for commands. You can write in <b>English or हिंदी</b>, and switch anytime.</div>
      </div>
    </aside>

    <!-- Chat -->
    <main id="chat" class="panel">
      <div id="chatbox">
        <div id="topbar">
          <div id="status">🙂 Ready</div>
          <div id="langWrap">
            <button class="langBtn" id="langHindi" aria-pressed="false">हिंदी</button>
            <button class="langBtn" id="langEnglish" aria-pressed="true">English</button>
          </div>
        </div>
        <div id="chatlogs"></div>
        <div class="chips" id="suggestions"></div>
        <div id="inputArea">
          <input id="inputBox" type="text" placeholder="Type your message… (/help for options)" autocomplete="off" />
          <button id="sendBtn">Send</button>
        </div>
      </div>
    </main>
  </div>

  <script>
    // ====== Utilities ======
    const $ = sel => document.querySelector(sel);
    const chatlogs = $('#chatlogs');
    const inputBox = $('#inputBox');
    const sendBtn = $('#sendBtn');
    const langHindi = $('#langHindi');
    const langEnglish = $('#langEnglish');
    const suggestions = $('#suggestions');
    const statusEl = $('#status');
    const themeToggle = $('#themeToggle');
    const body = document.body;

    function nowTime() {
      const d = new Date();
      return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    function appendMessage(text, who = 'bot', opts = {}) {
      const div = document.createElement('div');
      div.className = `msg ${who}`;
      div.innerHTML = text + `<span class="time">${opts.time || nowTime()}</span>`;
      chatlogs.appendChild(div);
      chatlogs.scrollTop = chatlogs.scrollHeight;
    }
    function setTyping(on = true) {
      if (on) {
        appendMessage(currentLang === 'hi' ? 'टाइप कर रहा हूँ…' : 'Typing…', 'bot', { time: '' });
        chatlogs.lastChild.classList.add('typing');
      } else if (chatlogs.lastChild && chatlogs.lastChild.classList.contains('typing')) {
        chatlogs.removeChild(chatlogs.lastChild);
      }
    }
    function chip(text, handler) {
      const b = document.createElement('button');
      b.className = 'chip';
      b.textContent = text;
      b.addEventListener('click', handler);
      return b;
    }

    // ====== Language & State ======
    let currentLang = 'en';
    let context = { intent: null, sub: null, mood: null, crisis: false };

    function setLang(lang) {
      currentLang = lang;
      langHindi.setAttribute('aria-pressed', lang === 'hi');
      langEnglish.setAttribute('aria-pressed', lang === 'en');
      inputBox.placeholder = lang === 'hi' ? 'अपना संदेश लिखें… (/help सहायता के लिए)' : 'Type your message… (/help for options)';
      greet();
    }

    function greet() {
      chatlogs.innerHTML = '';
      const hi = currentLang === 'hi';
      appendMessage(hi ? 'अवलोकन में आपका स्वागत है! आप कैसे महसूस कर रहे हैं? आप हिंदी या अंग्रेज़ी किसी में भी बात कर सकते हैं।' : 'Welcome to Avlokan! How are you feeling today? You can chat in English or Hindi.', 'bot');
      renderSuggestions(['stress','anxiety','sleep','study','lonely','angry','panic','/help']);
    }

    // ====== Lexicon & Intents ======
    const INTENTS = [
      { id: 'crisis', en: [/suicide|kill myself|end my life|hurt myself|self\s*harm|cutting|can\s*t go on|i want to die|worthless/i], hi: [/आत्महत्या|ख़त्म करना|खतम करना|खुद को नुकसान|कटिंग|मरना चाहता|जी नहीं पा/i], handler: handleCrisis },
      { id: 'greeting', en: [/hello|hi\b|hey|good (morning|afternoon|evening)/i], hi: [/नमस्ते|सलाम|हाय|सुप्रभात|शुभ\s*(संध्या|रात्रि|दोपहर)/], handler: handleGreeting },
      { id: 'stress', en: [/stress(ed)?|overwhelm|burnout|pressure/i], hi: [/तनाव|दबाव|थकावट|ओवरवेल्म/], handler: handleStress },
      { id: 'anxiety', en: [/anxiety|anxious|worry|nervous|panic( attack)?/i], hi: [/चिंता|घबराहट|बेचैनी|पैनिक/], handler: handleAnxiety },
      { id: 'sleep', en: [/sleep|insomnia|can\'?t (sleep|fall asleep)|night(mare| terror)s?/i], hi: [/नींद|नीद|सो नहीं पा|खराब (नींद|सपना)/], handler: handleSleep },
      { id: 'mood_low', en: [/sad|depress(ed|ion)?|low mood|empty|cry/i], hi: [/उदास|डिप्रेशन|मन (उदास|खाली)/], handler: handleLowMood },
      { id: 'anger', en: [/angry|irritat(ed|ion)|rage|mad/i], hi: [/गुस्सा|चिढ़|क्रोध/], handler: handleAnger },
      { id: 'lonely', en: [/lonely|alone|no one (cares|understands)/i], hi: [/अकेल|कोई नहीं समझता/], handler: handleLonely },
      { id: 'study', en: [/study|exam|test|assignment|focus|procrastinat(e|ion)/i], hi: [/पढ़ाई|इम्तिहान|परीक्षा|असाइनमेंट|टालमटोल/], handler: handleStudy },
      { id: 'relationship', en: [/friend(ship)?|breakup|relationship|parents?|teacher|bully/i], hi: [/दोस्ती|रिश्ता|ब्रेकअप|माता\s*पिता|अभिभावक|टीचर|बदमाशी|बुली/], handler: handleRelationship },
      { id: 'body', en: [/body (image|shame)|weight|diet|look|appearance/i], hi: [/शरीर|वजन|दिखावट|बॉडी/], handler: handleBody },
      { id: 'help', en: [/^\/help\b|help|what can you do/i], hi: [/^\/help\b|मदद|क्या कर सकते/], handler: handleHelp },
      { id: 'tool_cmd', en: [/^\/(ground|boxbreathe|478|reframe|journal|sleep|study|helpnow)\b/i], hi: [/^\/(ground|boxbreathe|478|reframe|journal|sleep|study|helpnow)\b/], handler: handleToolCommand },
      { id: 'gratitude', en: [/thank(s| you)|appreciate/i], hi: [/धन्यवाद|शुक्रिया|थैंक/], handler: handleThanks },
      { id: 'goodbye', en: [/bye|goodbye|see you|gtg/i], hi: [/अलविदा|चलता हूँ|फिर मिलेंगे/], handler: handleBye },
    ];

    // ====== Core Router ======
    function detectIntent(text) {
      for (const intent of INTENTS) {
        const arr = currentLang === 'hi' ? intent.hi : intent.en;
        for (const rx of arr) {
          if (rx.test(text)) return intent;
        }
      }
      return null;
    }

    function route(text) {
      // Basic moderation for profanity (soft)
      if (/\b(fuck|shit|bitch|asshole|चूत|साला)\b/i.test(text)) {
        appendMessage(currentLang === 'hi' ? 'मैं समझता हूँ कि भावनाएँ तीव्र हो सकती हैं। चलिए इसे मिलकर सँभालते हैं—क्या आप चाहेंगे कि मैं आपको शांत करने की एक कसरत कराऊँ?' : "I hear a lot of intensity there. Let's channel it safely—want a quick calming exercise?", 'bot');
        renderSuggestions(['/ground', '/boxbreathe', 'anger', 'stress']);
        return;
      }
      const intent = detectIntent(text);
      if (intent) {
        intent.handler(text);
      } else {
        handleFallback(text);
      }
    }

    // ====== Handlers (detailed answers) ======

    function handleCrisis() {
      context.crisis = true;
      const m = currentLang === 'hi'
        ? `<b>मैं आपकी सुरक्षा को सबसे पहले रखता हूँ।</b> यदि आप खुद को नुकसान पहुंचाने के बारे में सोच रहे हैं, तो <b>तुरंत</b> किसी भरोसेमंद व्यक्ति से संपर्क करें, अपने स्थानीय आपातकालीन नंबर <b>112</b> पर कॉल करें, या निकटतम अस्पताल जाएँ।<br><br>मैं आपके साथ हूँ। जब तक सहायता पहुँचती है, क्या आप मेरे साथ साँस लेने की कसरत करेंगे? <span class="kbd">/ground</span> या <span class="kbd">/478</span> टाइप करें।`
        : `<b>Your safety comes first.</b> If you're thinking about harming yourself, please <b>seek immediate help</b>: call your local emergency number (e.g., <b>112</b>), tell a trusted person nearby, or go to the nearest hospital.<br><br>I'm here with you. While help arrives, would you try a breathing exercise with me? Type <span class="kbd">/ground</span> or <span class="kbd">/478</span>.`;
      appendMessage(m, 'bot');
      renderSuggestions(['/helpnow', 'trusted person', 'grounding', 'breathing']);
    }

    function handleGreeting() {
      appendMessage(currentLang === 'hi' ? 'नमस्ते! आज आपका मन कैसा है? एक शब्द में बताएँ (जैसे: शांत, चिंतित, थका हुआ)।' : 'Hi! How does your mind feel right now? Share one word (e.g., calm, anxious, tired).', 'bot');
      renderSuggestions(['stress', 'anxiety', 'sleep', 'study', 'lonely']);
    }

    function handleStress() {
      appendMessage(
        currentLang === 'hi'
          ? 'तनाव शरीर और मन दोनों को प्रभावित करता है। आमतौर पर ये तब आता है जब हमारी अपेक्षाएँ, जिम्मेदारियाँ या भविष्य को लेकर चिंता बढ़ जाती हैं।<br><br>' +
          'कारण क्या हो सकते हैं?<ul><li>बहुत अधिक सोशल मीडिया इस्तेमाल</li><li>किसी एक विषय/काम की चिंता</li><li>पूरा ना कर पाने का डर</li><li>कम सोना या थकावट</li></ul>' +
          '⭐ <b>प्राकृतिक समाधान:</b> तनाव कम करने की कोशिश करें—दिन में कुछ मिनट गहरी साँस लें (Box Breathing) या 5-4-3-2-1 ग्राउंडिंग आज़माएँ। समय थोड़ी देर के लिए फोन अलग रखें और बाहर टहलें। आप चाहें तो मुझसे तनाव का कारण चर्चा कर सकते हैं।'
          : 'Stress affects both mind and body. It often arises when our expectations, responsibilities, or worries about the future become overwhelming.<br><br>' +
          'What can trigger stress?<ul><li>Spending lots of time on social media</li><li>Concerns about a specific topic or task</li><li>Fear of not meeting expectations</li><li>Lack of sleep or fatigue</li></ul>' +
          '⭐ <b>Natural solution:</b> Try to de-stress by practicing slow deep breathing (Box Breathing) or the 5-4-3-2-1 grounding exercise. Put your phone away for a bit and take a short walk. You’re welcome to talk to me more about what’s causing your stress.'
      , 'bot'
      );
      renderSuggestions(['/boxbreathe', '/ground', '/reframe', 'work', 'exams', 'family']);
    }

    function handleAnxiety() {
      appendMessage(
        currentLang === 'hi'
          ? 'चिंता कभी-कभी अज्ञात कारणों से भी आ सकती है। इससे दिल तेज़ धड़कना, बार-बार किसी बात की टेंशन होना, या भविष्य की अनिश्चितता महसूस होना शामिल है।<br><br>' +
          'क्या कारण हो सकते हैं? <ul><li>ख़बर या सोशल मीडिया की अति</li><li>अज्ञात चुनौतियों से डर</li><li>अकेलापन या बार-बार दुखी संगीत सुनना</li></ul>' +
          '⭐ <b>क्या करें?</b> 4-7-8 ब्रीदिंग आज़माएँ, मन को वर्तमान पर केंद्रित करें, और विचारों को लिख डालें—इससे उन्हें चुनौती दी जा सकती है।'
          : 'Anxiety can show up sometimes without a clear reason. It might include fast heartbeat, repeated worrying, or fear of the unknown.<br><br>' +
          'What might cause it?<ul><li>Overuse of news or social media</li><li>Fear of uncertain challenges</li><li>Isolation or listening to sad music repeatedly</li></ul>' +
          '⭐ <b>What helps?</b> Try the 4-7-8 breathing exercise, bring your attention to the present, and write out your thoughts—this can help you challenge those worries.'
      , 'bot'
      );
      renderSuggestions(['/478', '/ground', '/reframe', 'panic']);
    }

    function handleSleep() {
      appendMessage(
        currentLang === 'hi'
          ? 'नींद शरीर और मानसिक स्वास्थ्य के लिए बहुत जरूरी है। खराब नींद की वजहें हो सकती हैं—लंबा स्क्रीन टाइम, देर रात तक गाने सुनना (खासकर उदास), या चिंता।<br><br>' +
          'संकेत: <ul><li>सोने-उठने का समय रेगुलर नहीं</li><li>रात में उठना या बेचैनी</li></ul>' +
          '⭐ <b>टिप्स:</b> नियमित समय पर सोएं, सोने से 1-2 घंटे पहले मोबाइल/स्क्रीन दूर रखें, शांत संगीत या गहरी साँसें लें, कैफीन कम करें। सोने में दिक्कत हो तो <span class="kbd">/sleep</span> टाइप करें।'
          : 'Sleep is critical for mind and body. Poor sleep can be caused by too much screen time, staying up late listening to music (especially sad songs), or anxiety.<br><br>' +
          'Warning signs: <ul><li>Irregular sleep/wake times</li><li>Restlessness or waking in the night</li></ul>' +
          '⭐ <b>Tips:</b> Stick to a regular sleep schedule, turn off screens 1-2 hours before bed, listen to calming music or practice deep breathing, and cut down on caffeine. For a checklist, type <span class="kbd">/sleep</span>.'
      , 'bot'
      );
      renderSuggestions(['/sleep', 'anxiety', 'stress', 'night routine']);
    }

    function handleLowMood() {
      appendMessage(
        currentLang === 'hi'
          ? 'खराब मूड या उदासी का मतलब यह नहीं कि आप अकेले हैं। कई बार सोशल मीडिया की तुलना, बार-बार निराशा, या लगातार उदास गाने सुनना ऐसा कर सकते हैं।<br><br>' +
          '⭐ <b>क्या करें?</b> अपनी भावनाएँ शब्दों में लिखें (<span class="kbd">/journal</span> ट्राय करें), हल्की चहलकदमी करें, या दोस्तों से बात करने की कोशिश करें। छोटे कदम से शुरुआत करें।'
          : 'Feeling low is very common. Comparing yourself on social media, repeated disappointments, or listening to sad music often can make it worse.<br><br>' +
          '⭐ <b>Try this:</b> Write your feelings out (try <span class="kbd">/journal</span>), take a gentle walk, or message a friend. Start with tiny steps.'
      , 'bot'
      );
      renderSuggestions(['/journal', '/reframe', 'go for a walk', 'text a friend']);
    }

    function handleAnger() {
      appendMessage(
        currentLang === 'hi'
          ? 'गुस्सा आना एक स्वाभाविक भावना है, पर अक्सर यह नींद, भूख या तनाव के कारण रह सकता है।<br><br>सोचें- हाल में किस बात/व्यक्ति ने आपको सबसे अधिक उकसाया?<br>' +
          '⭐ <b>क्या करें?</b> पहले शरीर को शांत करें—गहरी साँस लें (<span class="kbd">/boxbreathe</span> ट्राय करें), फिर अपनी सोच/भाव पर ध्यान दें और जरूरत हो तो ब्रेक लें।'
          : 'Anger is a normal emotion, but it’s often triggered by lack of sleep, hunger, or underlying stress.<br><br>Think—what or who most annoyed you recently?<br>' +
          '⭐ <b>Try this:</b> Calm your body first (try deep breathing with <span class="kbd">/boxbreathe</span>), then notice your thoughts and feelings, and take a break if necessary.'
      , 'bot'
      );
      renderSuggestions(['/boxbreathe', '/ground', 'count to 10', 'anxiety']);
    }

    function handleLonely() {
      appendMessage(
        currentLang === 'hi'
          ? 'अकेलापन आपको थका या आहत कर सकता है। इसके कारण सोशल मीडिया पर दूसरों से तुलना, अकेले समय ज्यादा बिताना, या सहायक नेटवर्क की कमी हो सकती है।<br><br>' +
          '⭐ <b>प्राकृतिक समाधान:</b> एक दोस्त को सन्देश भेजें, किसी क्लब या ग्रुप को जॉइन करें, या थोड़ी देर बाहर टहलें। हल्के सामाजिक कदम बहुत उपयोगी हो सकते हैं।'
          : 'Loneliness can feel exhausting or painful. It may happen from comparing yourself to others online, spending too much time alone, or lacking a support network.<br><br>' +
          '⭐ <b>Natural solution:</b> Text a friend, join a group or club, or step outside for a while. Small social steps often help a lot.'
      , 'bot'
      );
      renderSuggestions(['text a friend', 'join a group', '/journal']);
    }

    function handleStudy() {
      appendMessage(
        currentLang === 'hi'
          ? 'पढ़ाई का तनाव ज्यादातर तब आता है जब कार्य बोझ बड़ा लगने लगे या ध्यान भटकता रहे (जैसे बार-बार फोन चेक करना)।<br><br>' +
          'कारण: <ul><li>अनियंत्रित सोशल मीडिया/डिवाइस</li><li>पूरा न कर पाने का डर</li><li>कार्य का बड़ा होना</li></ul>' +
          '⭐ <b>क्या करें?</b> काम को छोटे-छोटे हिस्सों में बाँटें (पोमोडोरो: 25 मिनट पढ़ाई + 5 मिनट ब्रेक)। ध्यान भटकाने वालों से दूरी बनायें और शेड्यूल बनायें।'
          : 'Study or exam pressure is common, especially if the workload feels huge or your attention is scattered (like checking your phone repeatedly).<br><br>' +
          'Causes: <ul><li>Uncontrolled social media/device use</li><li>Fear of not completing tasks</li><li>Overwhelming tasks</li></ul>' +
          '⭐ <b>What helps?</b> Break tasks down (try Pomodoro: 25min work + 5min break). Put away distractions and plan a simple schedule.'
      , 'bot'
      );
      renderSuggestions(['/study', '/reframe', 'procrastination', 'breakdown tasks']);
    }

    function handleRelationship() {
      appendMessage(
        currentLang === 'hi'
          ? 'रिश्तों में तनाव होना सामान्य है—यह दोस्तों, परिवार या सहकर्मियों के साथ हो सकता है।<br><br>अक्सर समस्याओं की जड़ गलतफहमी या संवाद की कमी हो सकती है। सोशल मीडिया पर तुलना भी तनाव बढ़ा सकती है।<br>' +
          '⭐ <b>क्या करें?</b> तथ्य, भावना, ज़रूरत और अनुरोध लिखें। संवाद में स्पष्टता रखें, जरूरत हो तो सीमाएँ बनायें।'
          : 'Relationship tension is normal—with friends, family, or co-workers. At the root are often misunderstandings or lack of communication. Comparisons on social media can also create stress.<br>' +
          '⭐ <b>Try this:</b> Write out facts, feelings, needs, and requests. Communicate clearly, and set boundaries when needed.'
      , 'bot'
      );
      renderSuggestions(['/journal', '/reframe', 'talk to them', 'set boundary']);
    }

    function handleBody() {
      appendMessage(
        currentLang === 'hi'
          ? 'शरीर की छवि को लेकर चिंता अकसर सोशल मीडिया तुलना या आलोचना सुन लेने से पैदा होती है।<br><br>कभी-कभी गाने और फ़िल्में भी छवि को प्रभावित करती हैं।<br>' +
          '⭐ <b>क्या करें?</b> खुद के लिए दयालु भाषा आज़माएँ, शरीर की ताकत पर ध्यान दें, और खुद की तुलना सिर्फ खुद से करें।'
          : 'Body image concerns often arise from social media comparisons or hearing criticism. Sometimes media and songs influence these perceptions.<br>' +
          '⭐ <b>Try this:</b> Practice kind language to yourself, focus on your body’s strengths, and compare yourself only to your past self.'
      , 'bot'
      );
      renderSuggestions(['/reframe', 'gratitude list', 'go for walk']);
    }

    function handleHelp() {
      const m = currentLang === 'hi'
        ? `उपलब्ध कमांड:
          <ul>
            <li><span class="kbd">/ground</span> – 5-4-3-2-1 ग्राउंडिंग</li>
            <li><span class="kbd">/boxbreathe</span> – बॉक्स ब्रीदिंग (4-4-4-4)</li>
            <li><span class="kbd">/478</span> – 4-7-8 ब्रीदिंग</li>
            <li><span class="kbd">/reframe</span> – नकारात्मक विचार का CBT रिफ़्रेम</li>
            <li><span class="kbd">/journal</span> – जर्नलिंग प्रॉम्प्ट</li>
            <li><span class="kbd">/sleep</span> – नींद हाइजीन टिप्स</li>
            <li><span class="kbd">/study</span> – फ़ोकस/पोमोडोरो सुझाव</li>
            <li><span class="kbd">/helpnow</span> – तात्कालिक सहायता निर्देश</li>
          </ul>`
        : `Available commands:
          <ul>
            <li><span class="kbd">/ground</span> – 5-4-3-2-1 grounding</li>
            <li><span class="kbd">/boxbreathe</span> – Box breathing (4-4-4-4)</li>
            <li><span class="kbd">/478</span> – 4-7-8 breathing</li>
            <li><span class="kbd">/reframe</span> – CBT thought reframe</li>
            <li><span class="kbd">/journal</span> – Journaling prompt</li>
            <li><span class="kbd">/sleep</span> – Sleep hygiene tips</li>
            <li><span class="kbd">/study</span> – Focus/Pomodoro suggestions</li>
            <li><span class="kbd">/helpnow</span> – Immediate help guidance</li>
          </ul>`;
      appendMessage(m, 'bot');
      renderSuggestions(['/ground', '/478', '/reframe']);
    }

    function handleToolCommand(text) {
      const cmd = text.match(/^\/(\w+)/)[1];
      const map = {
        ground: toolGround,
        boxbreathe: toolBox,
        '478': tool478,
        reframe: toolReframe,
        journal: toolJournal,
        sleep: toolSleep,
        study: toolStudy,
        helpnow: toolHelpNow,
      };
      if (map[cmd]) map[cmd]();
      else handleFallback(text);
    }

    function handleThanks() {
      appendMessage(currentLang === 'hi' ? 'आपका स्वागत है। आप अकेले नहीं हैं—मैं साथ हूँ।' : "You're welcome. You're not alone—I'm with you.", 'bot');
      renderSuggestions(['something else', '/journal', '/ground']);
    }

    function handleBye() {
      appendMessage(currentLang === 'hi' ? 'ख़याल रखें। जब चाहें वापस आएँ।' : 'Take care. Come back anytime.', 'bot');
      renderSuggestions([]);
    }

    function handleFallback(text) {
      if (/[\u0900-\u097F]/.test(text) && currentLang !== 'hi') {
        setLang('hi');
      }
      const msg =
        currentLang === 'hi'
          ? 'मैं पूरी कोशिश कर रहा हूँ समझने की। क्या आप थोड़ा और बताएँ? आप <span class="kbd">/help</span> भी ट्राय कर सकते हैं।'
          : "I'm trying to understand. Could you share a bit more? You can also try <span class=\"kbd\">/help</span>.";
      appendMessage(msg, 'bot');
      renderSuggestions(['stress', 'sleep', 'anxiety', '/help']);
    }

    // ====== Tools ======
    function toolGround() {
      const m =
        currentLang === 'hi'
          ? `<b>5-4-3-2-1 ग्राउंडिंग</b><br>यह तकनीक आपके मन को वर्तमान में ले आती है और चिंता को कम करती है। पाँच चीज़ें देखें, चार छुएं, तीन सुनें, दो सूंघें, एक स्वाद चखें। हर स्टेप के बीच गहरी साँस लें।`
          : `<b>5-4-3-2-1 Grounding</b><br>This technique brings your mind to the present and reduces anxiety. Notice five things you see, four you can touch, three you hear, two you smell, one you taste. Take deep breaths between steps.`;
      appendMessage(m, 'bot');
    }
    function toolBox() {
      const m =
        currentLang === 'hi'
          ? `<b>बॉक्स ब्रीदिंग (4-4-4-4)</b><br>यह सांस लेने की नियमित प्रक्रिया शांति और ध्यान बढ़ाती है। चार सेकंड साँस लें, चार रोकें, चार छोड़ें, फिर चार रोकें। इसे 4-6 बार दोहराएँ।`
          : `<b>Box Breathing (4-4-4-4)</b><br>This breathing technique enhances calmness and focus. Inhale for 4 seconds, hold for 4, exhale for 4, and hold again for 4. Repeat 4–6 rounds.`;
      appendMessage(m, 'bot');
    }
    function tool478() {
      const m =
        currentLang === 'hi'
          ? `<b>4-7-8 ब्रीदिंग</b><br>यह नर्वस सिस्टम को शांत करता है। 4 सेकंड नाक से सांस लें, 7 सेकंड रोकें, 8 सेकंड मुँह से छोड़ें। 4-8 बार करें।`
          : `<b>4-7-8 Breathing</b><br>This calms the nervous system. Inhale through your nose for 4 seconds, hold 7 seconds, exhale through your mouth for 8 seconds. Repeat 4–8 times.`;
      appendMessage(m, 'bot');
    }
    function toolReframe() {
      const m =
        currentLang === 'hi'
          ? `<b>CBT रिफ़्रेम</b><br>नकारात्मक सोच को चुनौती देने का तरीका। १) आपकी सोच, २) उसके लिए/खिलाफ सबूत, ३) एक संतुलित वैकल्पिक सोच। जैसे: “मैं हमेशा फेल होता हूँ” → “कभी-कभी कठिनाइयाँ आती हैं, पर मैंने पहले भी सफलता पाई है।”`
          : `<b>CBT Reframe</b><br>A method to challenge negative thoughts. 1) Your thought, 2) Evidence for and against it, 3) A balanced alternative thought. Example: “I always fail” → “Sometimes it’s hard, but I’ve succeeded before.”`;
      appendMessage(m, 'bot');
    }
    function toolJournal() {
      const m =
        currentLang === 'hi'
          ? `<b>जर्नलिंग प्रॉम्प्ट</b><br>आज क्या हुआ? आपने क्या महसूस किया? आपकी कौन सी ज़रूरत पूरी नहीं हुई? अगला छोटा कदम क्या हो सकता है? लिखिए।`
          : `<b>Journaling Prompt</b><br>What happened today? What did you feel? What need was unmet? What tiny next step can you take? Write it down.`;
      appendMessage(m, 'bot');
    }
    function toolSleep() {
      const m =
        currentLang === 'hi'
          ? `<b>नींद हाइजीन टिप्स</b><ul><li>हर दिन एक ही समय पर सोने और जागने की कोशिश करें</li><li>सोते समय से 1-2 घंटे पहले स्क्रीन बंद करें</li><li>शाम 4 बजे के बाद कैफीन से बचें</li><li>कमरा ठंडा और अंधेरा रखें</li><li>बिस्तर केवल सोने और आराम के लिए रखें</li></ul>`
          : `<b>Sleep Hygiene Tips</b><ul><li>Try to sleep and wake at the same time every day</li><li>Turn off screens 1-2 hours before bed</li><li>Avoid caffeine after 4 PM</li><li>Keep your room cool and dark</li><li>Use your bed only for sleeping and relaxing</li></ul>`;
      appendMessage(m, 'bot');
    }
    function toolStudy() {
      const m =
        currentLang === 'hi'
          ? `<b>फ़ोकस (पोमोडोरो) तकनीक</b><br>२५ मिनट पढ़ाई करें, फिर ५ मिनट का ब्रेक लें। इसे चार बार करें, फिर एक लंबा ब्रेक। पढ़ाई को छोटे-छोटे हिस्सों में बांटें ताकि इसे पूरा करना आसान हो।`
          : `<b>Focus (Pomodoro) Technique</b><br>Study for 25 minutes, then take a 5-minute break. Repeat this four times, then take a longer break. Break work into smaller parts to make it manageable.`;
      appendMessage(m, 'bot');
    }
    function toolHelpNow() {
      const m =
        currentLang === 'hi'
          ? `<b>तुरंत सहायता</b><br>अगर खतरा है: १) आसपास किसी को बताएं २) स्थानीय आपातकालीन नंबर (<b>112</b>) पर कॉल करें ३) निकटतम अस्पताल या क्लिनिक जाएं। मैं आपके साथ हूँ।`
          : `<b>Immediate Help</b><br>If at risk: 1) Tell someone nearby 2) Call your local emergency number (e.g., <b>112</b>) 3) Go to the nearest hospital or clinic. I'm with you.`;
      appendMessage(m, 'bot');
    }

    // ====== Suggestions ======
    function renderSuggestions(items) {
      suggestions.innerHTML = '';
      (items || []).forEach(it =>
        suggestions.appendChild(
          chip(String(it), () => {
            inputBox.value = it;
            sendMessage();
          })
        )
      );
    }

    // ====== I/O ======
    function sendMessage() {
      const userInput = inputBox.value.trim();
      if (!userInput) return;
      appendMessage(userInput, 'user');
      inputBox.value = '';
      setTyping(true);
      setTimeout(() => {
        setTyping(false);
        route(userInput);
      }, 450);
    }

    // ====== Events ======
    sendBtn.addEventListener('click', sendMessage);
    inputBox.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });
    langHindi.addEventListener('click', () => setLang('hi'));
    langEnglish.addEventListener('click', () => setLang('en'));
    document.querySelectorAll('[data-tool]').forEach(el =>
      el.addEventListener('click', () => {
        inputBox.value = el.dataset.tool;
        sendMessage();
      })
    );

    themeToggle.addEventListener('click', () => {
      if (body.getAttribute('data-theme') === 'light') {
        body.setAttribute('data-theme', 'dark');
        themeToggle.textContent = 'Light Mode';
      } else {
        body.setAttribute('data-theme', 'light');
        themeToggle.textContent = 'Dark Mode';
      }
    });

    // ====== Boot ======
    setLang('en');
  </script>
</body>
</html>
